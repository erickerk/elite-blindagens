<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Elite Blindagens - Portal Administrativo</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<script src="https://cdn.tailwindcss.com"></script>
<script src="supabase-config.js"></script>
<script src="admin-supabase.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<!-- QR Code library direto para melhor compatibilidade -->
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/polyfills.umd.js"></script>
<script>
tailwind.config = {
theme: {
extend: {
colors: { primary: '#D4AF37', secondary: '#1a1a2e' },
fontFamily: { sans: ['Poppins', 'sans-serif'] }
}
}
}
</script>
<style>
.golden-gradient { background: linear-gradient(135deg, #D4AF37 0%, #F4E4A6 50%, #D4AF37 100%); }
.qr-code-box { background-color: white; width: 256px; height: 256px; margin: 0 auto; display: flex; justify-content: center; align-items: center; }
</style>
</head>
<body class="font-sans bg-gray-100 min-h-screen">

<!-- Login Screen -->
<div id="login-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-secondary to-gray-900">
<div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
<div class="text-center mb-8">
<img src="assets/logo-elite.png" alt="Elite Blindagens" class="h-16 mx-auto mb-4">
<p class="text-gray-500 mt-2">Portal Administrativo</p>
</div>
<form id="login-form" class="space-y-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
<input type="email" id="login-user" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Digite seu e-mail">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
<input type="password" id="login-pass" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Digite sua senha">
</div>
<div id="login-error" class="hidden text-red-500 text-sm text-center"></div>
<button type="submit" class="w-full golden-gradient text-black py-3 rounded-lg font-semibold hover:shadow-lg transition-all">
Entrar
</button>
</form>
</div>
</div>

<!-- Admin Dashboard -->
<div id="admin-dashboard" class="hidden">
<!-- Header -->
<header class="bg-secondary text-white shadow-lg">
<div class="container mx-auto px-6 py-4 flex items-center justify-between">
<div class="flex items-center gap-4">
<h1 class="text-2xl font-bold">Elite Blindagens</h1>
<span class="bg-primary/20 text-primary px-3 py-1 rounded-full text-sm">Admin</span>
</div>
<div class="flex items-center gap-2">
<button onclick="exportarRelatorio()" class="flex items-center gap-2 bg-green-500/20 text-green-400 px-4 py-2 rounded-lg hover:bg-green-500/30 transition-all">
<i class="ri-file-excel-line"></i> Relatório Vendidos
</button>
<button onclick="logout()" class="flex items-center gap-2 bg-red-500/20 text-red-400 px-4 py-2 rounded-lg hover:bg-red-500/30 transition-all">
<i class="ri-logout-box-line"></i> Sair
</button>
</div>
</div>
</header>

<!-- Tabs -->
<div class="bg-white border-b">
<div class="container mx-auto px-6">
<nav class="flex gap-8">
<button onclick="showTab('emails')" class="tab-btn py-4 px-2 border-b-2 border-primary text-primary font-medium" data-tab="emails">
<i class="ri-mail-line mr-2"></i>E-mails Cadastrados
</button>
<button onclick="showTab('depoimentos')" class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="depoimentos">
<i class="ri-chat-quote-line mr-2"></i>Depoimentos
</button>
<button onclick="showTab('faq')" class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="faq">
<i class="ri-question-line mr-2"></i>FAQ
</button>
<button onclick="showTab('cases')" class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="cases">
<i class="ri-shield-star-line mr-2"></i>Cases de Sucesso
</button>
<button onclick="showTab('qrcode')" class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="qrcode">
<i class="ri-qr-code-line mr-2"></i>QR Code Apresentação
</button>
</nav>
</div>
</div>

<!-- Content -->
<main class="container mx-auto px-6 py-8">

<!-- Tab: E-mails -->
<div id="tab-emails" class="tab-content">
<div class="bg-white rounded-xl shadow-lg p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-2xl font-bold text-secondary">E-mails Cadastrados</h2>
<button onclick="exportEmails()" class="golden-gradient text-black px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all flex items-center gap-2">
<i class="ri-file-excel-line"></i> Exportar Excel
</button>
</div>
<div class="overflow-x-auto">
<table class="w-full">
<thead class="bg-gray-50">
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">E-mail</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data Cadastro</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
</tr>
</thead>
<tbody id="emails-table" class="divide-y divide-gray-200">
</tbody>
</table>
</div>
<p id="no-emails" class="hidden text-center text-gray-500 py-8">Nenhum e-mail cadastrado ainda.</p>
</div>
</div>

<!-- Tab: Depoimentos -->
<div id="tab-depoimentos" class="tab-content hidden">
<div class="bg-white rounded-xl shadow-lg p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-2xl font-bold text-secondary">Depoimentos de Clientes</h2>
<button onclick="openDepoimentoModal()" class="golden-gradient text-black px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all flex items-center gap-2">
<i class="ri-add-line"></i> Adicionar Depoimento
</button>
</div>
<div id="depoimentos-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
</div>
<p id="no-depoimentos" class="hidden text-center text-gray-500 py-8">Nenhum depoimento cadastrado ainda.</p>
</div>
</div>

<!-- Tab: FAQ -->
<div id="tab-faq" class="tab-content hidden">
<div class="bg-white rounded-xl shadow-lg p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-2xl font-bold text-secondary">Perguntas Frequentes</h2>
<button onclick="openFaqModal()" class="golden-gradient text-black px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all flex items-center gap-2">
<i class="ri-add-line"></i> Adicionar Pergunta
</button>
</div>
<div id="faq-list" class="space-y-3">
</div>
<p id="no-faq" class="hidden text-center text-gray-500 py-8">Nenhuma pergunta cadastrada ainda.</p>
</div>
</div>

<!-- Tab: Cases de Sucesso -->
<div id="tab-cases" class="tab-content hidden">
<div class="bg-white rounded-xl shadow-lg p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-2xl font-bold text-secondary">Cases de Sucesso</h2>
<button onclick="openCaseModal()" class="golden-gradient text-black px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all flex items-center gap-2">
<i class="ri-add-line"></i> Novo Case
</button>
</div>
<div id="cases-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
</div>
<p id="no-cases" class="hidden text-center text-gray-500 py-8">Nenhum case cadastrado ainda.</p>
</div>
</div>

<!-- Tab: QR Code Apresentação -->
<div id="tab-qrcode" class="tab-content hidden">
<div class="bg-white rounded-xl shadow-lg p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-2xl font-bold text-secondary">QR Code - Apresentação Elite Blindagens</h2>
</div>

<div class="grid md:grid-cols-2 gap-8">
<!-- QR Code Preview -->
<div class="text-center">
<div class="bg-gray-50 rounded-2xl p-8 inline-block">
<div class="bg-white p-4 rounded-xl shadow-inner">
<div id="qrcode-container" class="qr-code-box"></div>
</div>
<p class="mt-4 text-sm text-gray-500">QR Code fixo e permanente</p>
</div>

<div class="mt-6 space-y-3">
<button onclick="downloadQRCodePDF()" class="w-full golden-gradient text-black px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all flex items-center justify-center gap-2">
<i class="ri-file-pdf-line text-xl"></i> Baixar QR Code em PDF
</button>
<button onclick="downloadQRCodePNG()" class="w-full bg-secondary text-white px-6 py-3 rounded-lg font-semibold hover:bg-secondary/90 transition-all flex items-center justify-center gap-2">
<i class="ri-image-line text-xl"></i> Baixar QR Code em PNG
</button>
</div>
</div>

<!-- Info -->
<div class="space-y-6">
<div class="bg-primary/10 border border-primary/30 rounded-xl p-6">
<h3 class="font-bold text-secondary mb-3 flex items-center gap-2">
<i class="ri-information-line text-primary text-xl"></i> Informações
</h3>
<ul class="space-y-2 text-sm text-gray-700">
<li class="flex items-start gap-2">
<i class="ri-check-line text-green-500 mt-0.5"></i>
<span>Este QR Code direciona para a <strong>apresentação oficial</strong> da Elite Blindagens</span>
</li>
<li class="flex items-start gap-2">
<i class="ri-check-line text-green-500 mt-0.5"></i>
<span>A URL é <strong>fixa e permanente</strong> - nunca será alterada</span>
</li>
<li class="flex items-start gap-2">
<i class="ri-check-line text-green-500 mt-0.5"></i>
<span>O PDF baixado inclui o <strong>logo da Elite Blindagens</strong></span>
</li>
<li class="flex items-start gap-2">
<i class="ri-check-line text-green-500 mt-0.5"></i>
<span>Ideal para <strong>cartões de visita, folders e materiais impressos</strong></span>
</li>
</ul>
</div>

<div class="bg-gray-50 rounded-xl p-6">
<h3 class="font-bold text-secondary mb-3 flex items-center gap-2">
<i class="ri-link text-primary text-xl"></i> URL da Apresentação
</h3>
<div class="bg-white border rounded-lg p-3 flex items-center gap-2">
<input type="text" id="apresentacao-url" readonly value="" class="flex-1 text-sm text-gray-600 bg-transparent outline-none" title="URL da apresentação" aria-label="URL da apresentação">
<button onclick="copyApresentacaoUrl()" class="text-primary hover:text-primary/80 transition-colors" title="Copiar URL">
<i class="ri-file-copy-line text-xl"></i>
</button>
</div>
<p class="mt-2 text-xs text-gray-500">Clique no ícone para copiar a URL</p>
</div>

<div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
<h3 class="font-bold text-blue-800 mb-2 flex items-center gap-2">
<i class="ri-shield-check-line text-blue-600 text-xl"></i> Segurança
</h3>
<p class="text-sm text-blue-700">
O conteúdo da apresentação está armazenado de forma segura no Supabase Storage com acesso público somente leitura. O arquivo não pode ser modificado ou excluído sem autorização administrativa.
</p>
</div>

<!-- Atualizar PDF -->
<div class="bg-orange-50 border border-orange-200 rounded-xl p-6">
<h3 class="font-bold text-orange-800 mb-3 flex items-center gap-2">
<i class="ri-refresh-line text-orange-600 text-xl"></i> Atualizar Apresentação
</h3>
<p class="text-sm text-orange-700 mb-4">
Faça upload de um novo PDF para substituir a apresentação atual. <strong>O QR Code permanecerá o mesmo</strong> - apenas o conteúdo será atualizado.
</p>
<div class="space-y-3">
<input type="file" id="novo-pdf-input" accept="application/pdf" class="hidden" onchange="handleNovoPdfUpload(this)" title="Selecionar novo PDF" aria-label="Upload de novo PDF">
<button type="button" onclick="document.getElementById('novo-pdf-input').click()" id="btn-upload-pdf" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-all font-medium">
<i class="ri-upload-cloud-line text-xl"></i>
<span>Selecionar Novo PDF</span>
</button>
<div id="upload-progress" class="hidden">
<div class="flex items-center gap-3 p-3 bg-white rounded-lg border">
<i class="ri-loader-4-line animate-spin text-orange-500 text-xl"></i>
<span class="text-sm text-gray-600">Fazendo upload...</span>
</div>
</div>
<div id="upload-success" class="hidden">
<div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg border border-green-200">
<i class="ri-check-line text-green-500 text-xl"></i>
<span class="text-sm text-green-700">Apresentação atualizada com sucesso!</span>
</div>
</div>
<p class="text-xs text-orange-600">
<i class="ri-information-line"></i> Tamanho máximo: 50MB | Formato: PDF
</p>
</div>
</div>
</div>
</div>
</div>
</div>

</main>
</div>

<!-- Modal: Adicionar/Editar Depoimento -->
<div id="depoimento-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
<div class="bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
<div class="p-6 border-b flex justify-between items-center">
<h3 class="text-xl font-bold text-secondary" id="depoimento-modal-title">Adicionar Depoimento</h3>
<button onclick="closeDepoimentoModal()" class="text-gray-500 hover:text-gray-700" aria-label="Fechar" title="Fechar"><i class="ri-close-line text-2xl" aria-hidden="true"></i></button>
</div>
<form id="depoimento-form" class="p-6 space-y-4">
<input type="hidden" id="depoimento-id">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Nome do Cliente *</label>
<input type="text" id="depoimento-nome" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ex: João Silva">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Profissão</label>
<input type="text" id="depoimento-profissao" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ex: Empresário">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Depoimento *</label>
<textarea id="depoimento-texto" rows="4" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="O que o cliente disse..."></textarea>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Foto do Cliente</label>
<div class="space-y-3">
<div class="flex gap-2">
<button type="button" onclick="document.getElementById('depoimento-file').click()" class="flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary/5 transition-all">
<i class="ri-upload-cloud-line text-xl text-gray-500"></i>
<span class="text-gray-600">Upload do PC</span>
</button>
<button type="button" onclick="document.getElementById('depoimento-camera').click()" class="flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary/5 transition-all">
<i class="ri-camera-line text-xl text-gray-500"></i>
<span class="text-gray-600">Tirar Foto</span>
</button>
</div>
<input type="file" id="depoimento-file" accept="image/*" class="hidden" onchange="handleDepoimentoImageUpload(this)" title="Selecionar foto do computador" aria-label="Upload de foto">
<input type="file" id="depoimento-camera" accept="image/*" class="hidden" onchange="handleDepoimentoImageUpload(this)" title="Tirar foto com câmera" aria-label="Capturar foto">
<input type="url" id="depoimento-foto" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ou cole a URL da foto...">
<div id="depoimento-preview" class="hidden">
<img id="depoimento-preview-img" src="" alt="Preview" class="w-24 h-24 object-cover rounded-full border-4 border-primary mx-auto">
<button type="button" onclick="clearDepoimentoImagePreview()" class="mt-2 text-red-500 text-sm hover:underline block mx-auto"><i class="ri-delete-bin-line"></i> Remover foto</button>
</div>
</div>
</div>
<div class="flex gap-4 pt-4">
<button type="button" onclick="closeDepoimentoModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancelar</button>
<button type="submit" class="flex-1 golden-gradient text-black px-4 py-2 rounded-lg font-semibold">Salvar</button>
</div>
</form>
</div>
</div>

<!-- Modal: FAQ -->
<div id="faq-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
<div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
<div class="p-6 border-b flex justify-between items-center">
<h3 class="text-xl font-bold text-secondary" id="faq-modal-title">Adicionar Pergunta</h3>
<button onclick="closeFaqModal()" class="text-gray-500 hover:text-gray-700" aria-label="Fechar" title="Fechar"><i class="ri-close-line text-2xl" aria-hidden="true"></i></button>
</div>
<form id="faq-form" class="p-6 space-y-4">
<input type="hidden" id="faq-id">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Pergunta *</label>
<input type="text" id="faq-question" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Digite a pergunta">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Resposta *</label>
<textarea id="faq-answer" rows="4" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Digite a resposta"></textarea>
</div>
<div class="flex items-center gap-3">
<input type="checkbox" id="faq-active" checked class="w-5 h-5 text-primary rounded">
<label for="faq-active" class="text-sm text-gray-700">Ativa</label>
</div>
<div class="flex gap-4 pt-4">
<button type="button" onclick="closeFaqModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancelar</button>
<button type="submit" class="flex-1 golden-gradient text-black px-4 py-2 rounded-lg font-semibold">Salvar</button>
</div>
</form>
</div>
</div>

<!-- Modal: Case -->
<div id="case-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
<div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
<div class="p-6 border-b flex justify-between items-center">
<h3 class="text-xl font-bold text-secondary" id="case-modal-title">Novo Case</h3>
<button onclick="closeCaseModal()" class="text-gray-500 hover:text-gray-700" aria-label="Fechar" title="Fechar"><i class="ri-close-line text-2xl" aria-hidden="true"></i></button>
</div>
<form id="case-form" class="p-6 space-y-4">
<input type="hidden" id="case-id">
<div class="grid md:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Modelo do Veículo *</label>
<input type="text" id="case-title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ex: Mercedes-Benz S500">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Cliente / Local *</label>
<input type="text" id="case-client" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ex: Roberto M. • São Paulo/SP">
</div>
</div>
<div class="grid grid-cols-3 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Nível</label>
<input type="text" id="case-level" value="III-A" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="III-A">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Prazo</label>
<input type="text" id="case-deadline" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ex: 18 dias">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Peso Adicional</label>
<input type="text" id="case-weight" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ex: +85kg">
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Tags (separadas por vírgula)</label>
<input type="text" id="case-tags" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ex: ENTREGUE, UltraLite™">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Descrição Curta *</label>
<textarea id="case-desc" required rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Descreva brevemente o projeto"></textarea>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Foto Principal *</label>
<div class="space-y-3">
<div class="flex gap-2">
<button type="button" onclick="document.getElementById('case-main-file').click()" class="flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary/5 transition-all">
<i class="ri-upload-cloud-line text-xl text-gray-500"></i>
<span class="text-gray-600">Upload Foto Principal</span>
</button>
</div>
<input type="file" id="case-main-file" accept="image/*" class="hidden" onchange="handleCaseMainUpload(this)" title="Upload da foto principal" aria-label="Upload da foto principal">
<input type="url" id="case-img-main" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary" placeholder="Ou cole URL da imagem...">
<div id="case-main-preview" class="hidden">
<img id="case-main-preview-img" src="" alt="Preview" class="w-full h-48 object-cover rounded-lg border">
<button type="button" onclick="clearCaseMainPreview()" class="mt-2 text-red-500 text-sm hover:underline"><i class="ri-delete-bin-line"></i> Remover foto</button>
</div>
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Galeria de Fotos</label>
<div class="space-y-3">
<button type="button" onclick="document.getElementById('case-gallery-files').click()" class="w-full flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary/5 transition-all">
<i class="ri-image-add-line text-xl text-gray-500"></i>
<span class="text-gray-600">Adicionar Fotos à Galeria</span>
</button>
<input type="file" id="case-gallery-files" accept="image/*" multiple class="hidden" onchange="handleCaseGalleryUpload(this)" title="Upload de fotos da galeria" aria-label="Upload de fotos da galeria">
<div id="case-gallery-preview" class="grid grid-cols-3 gap-3">
<!-- Fotos da galeria serão exibidas aqui -->
</div>
<input type="hidden" id="case-gallery" value="">
</div>
</div>
<div class="flex gap-4 pt-4">
<button type="button" onclick="closeCaseModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancelar</button>
<button type="submit" class="flex-1 golden-gradient text-black px-4 py-2 rounded-lg font-semibold">Salvar Case</button>
</div>
</form>
</div>
</div>

<script>
// Senha do admin do site: Elite@2024#Admin!
const ADMIN_PASSWORD = 'Elite@2024#Admin!';

// Verificar sessão
function checkSession() {
const session = sessionStorage.getItem('elite_site_admin');
if (session) {
try {
const adminData = JSON.parse(session);
if (adminData.email && adminData.logged_at) {
showDashboard(adminData);
return;
}
} catch (e) {}
}
}

// Login via Supabase
document.getElementById('login-form').addEventListener('submit', async function(e) {
e.preventDefault();
const email = document.getElementById('login-user').value.trim();
const pass = document.getElementById('login-pass').value;
const errorEl = document.getElementById('login-error');
const submitBtn = this.querySelector('button[type="submit"]');

submitBtn.disabled = true;
submitBtn.textContent = 'Verificando...';
errorEl.classList.add('hidden');

try {
// Buscar admin no Supabase
const response = await fetch(`${SUPABASE_URL}/rest/v1/site_admin_users?email=eq.${encodeURIComponent(email)}&is_active=eq.true&select=*`, {
  headers: {
    'apikey': SUPABASE_ANON_KEY,
    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
  }
});
const admins = await response.json();

if (admins.length === 0) {
  throw new Error('E-mail não encontrado');
}

// Verificar senha (comparação simples - em produção usar bcrypt)
if (pass !== ADMIN_PASSWORD) {
  throw new Error('Senha incorreta');
}

const admin = admins[0];

// Salvar sessão
const sessionData = {
  id: admin.id,
  email: admin.email,
  name: admin.name,
  logged_at: new Date().toISOString()
};
sessionStorage.setItem('elite_site_admin', JSON.stringify(sessionData));

// Atualizar último login no Supabase
fetch(`${SUPABASE_URL}/rest/v1/site_admin_users?id=eq.${admin.id}`, {
  method: 'PATCH',
  headers: {
    'apikey': SUPABASE_ANON_KEY,
    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ last_login: new Date().toISOString() })
});

showDashboard(sessionData);

} catch (error) {
errorEl.textContent = error.message || 'Erro ao fazer login';
errorEl.classList.remove('hidden');
} finally {
submitBtn.disabled = false;
submitBtn.textContent = 'Entrar';
}
});

function showDashboard(adminData) {
document.getElementById('login-screen').classList.add('hidden');
document.getElementById('admin-dashboard').classList.remove('hidden');
// Mostrar nome do admin no header se disponível
if (adminData && adminData.name) {
  const adminBadge = document.querySelector('.bg-primary\\/20.text-primary');
  if (adminBadge) adminBadge.textContent = adminData.name;
}
loadEmails();
loadDepoimentos();
loadFaqs();
loadCases();
}

function logout() {
sessionStorage.removeItem('elite_site_admin');
location.reload();
}

// Exportar relatório de veículos vendidos
async function exportarRelatorio() {
const btn = event.target;
btn.disabled = true;
btn.innerHTML = '<i class="ri-loader-4-line animate-spin"></i> Gerando...';
try {
  const count = await exportarRelatorioVendidos();
  if (count > 0) {
    alert(`Relatório exportado com sucesso! ${count} veículo(s) vendido(s).`);
  }
} finally {
  btn.disabled = false;
  btn.innerHTML = '<i class="ri-file-excel-line"></i> Relatório Vendidos';
}
}

// Tabs
function showTab(tab) {
document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
document.querySelectorAll('.tab-btn').forEach(el => {
el.classList.remove('border-primary', 'text-primary');
el.classList.add('border-transparent', 'text-gray-500');
});
document.getElementById('tab-' + tab).classList.remove('hidden');
document.querySelector(`[data-tab="${tab}"]`).classList.add('border-primary', 'text-primary');
document.querySelector(`[data-tab="${tab}"]`).classList.remove('border-transparent', 'text-gray-500');
}

// E-mails, Depoimentos, FAQ e Cases agora são gerenciados pelo admin-supabase.js
// Funções removidas para evitar sobrescrita das funções do Supabase

// Funções de Depoimentos gerenciadas pelo admin-supabase.js

// FAQ e Cases gerenciados pelo admin-supabase.js

// Inicialização
checkSession();

// ==========================================
// QR CODE - APRESENTAÇÃO ELITE BLINDAGENS
// ==========================================

// URL FIXA da apresentação no Supabase Storage (NUNCA ALTERAR)
const APRESENTACAO_URL = 'https://rlaxbloitiknjikrpbim.supabase.co/storage/v1/object/public/apresentacoes/elite-blindagens-apresentacao.pdf';

// Gerar QR Code
async function generateQRCode() {
  const qrContainer = document.getElementById('qrcode-container');
  const urlInput = document.getElementById('apresentacao-url');
  
  if (!qrContainer) {
    console.error('[Elite] Container do QR Code não encontrado');
    return;
  }
  
  try {
    // Limpar o container antes de gerar novo QR code
    qrContainer.innerHTML = '';
    
    console.log('[Elite] Tentando gerar QR Code para:', APRESENTACAO_URL);
    
    // Usar método mais confiável para gerar o QR Code diretamente no container
    QRCode.toCanvas = QRCode.toCanvas || function() {};
    
    // Primeira tentativa: usar toCanvas diretamente no container
    new QRCode(qrContainer, {
      text: APRESENTACAO_URL,
      width: 256,
      height: 256,
      colorDark: '#1a1a2e',
      colorLight: '#ffffff',
      correctLevel: QRCode.CorrectLevel.H
    });
    
    // Atualizar URL no campo de input
    if (urlInput) {
      urlInput.value = APRESENTACAO_URL;
    }
    
    console.log('[Elite] QR Code gerado com sucesso');
  } catch (err) {
    console.error('[Elite] Erro ao gerar QR Code (método 1):', err);
    
    // Método alternativo em caso de erro
    try {
      qrContainer.innerHTML = '';
      
      // Criar uma imagem com o QR code
      const qrDataUrl = await QRCode.toDataURL(APRESENTACAO_URL, {
        width: 256,
        margin: 4,
        color: {
          dark: '#1a1a2e',
          light: '#ffffff'
        },
        errorCorrectionLevel: 'H'
      });
      
      // Criar imagem e adicionar ao container
      const img = new Image();
      img.src = qrDataUrl;
      img.style.width = '100%';
      img.style.height = '100%';
      img.alt = 'QR Code para Apresentação Elite Blindagens';
      qrContainer.appendChild(img);
      
      console.log('[Elite] QR Code gerado com método alternativo');
    } catch (altErr) {
      console.error('[Elite] Erro no método alternativo:', altErr);
      
      // Último método: mostrar mensagem de erro
      qrContainer.innerHTML = '<div style="padding: 20px; text-align: center;"><p style="color: #d00;">Erro ao gerar QR Code</p><p>Por favor, recarregue a página</p></div>';
    }
  }
}

// Copiar URL
function copyApresentacaoUrl() {
  const urlInput = document.getElementById('apresentacao-url');
  if (urlInput) {
    navigator.clipboard.writeText(urlInput.value).then(() => {
      alert('URL copiada para a área de transferência!');
    });
  }
}

// Download QR Code em PNG
async function downloadQRCodePNG() {
  const canvas = document.getElementById('qrcode-canvas');
  if (!canvas) {
    alert('Erro: QR Code não encontrado!');
    return;
  }
  
  try {
    // Gerar o QR Code novamente para garantir que está atualizado
    const qrDataUrl = await QRCode.toDataURL(APRESENTACAO_URL, {
      width: 512, // Maior resolução para download
      margin: 2,
      color: {
        dark: '#1a1a2e',
        light: '#ffffff'
      },
      errorCorrectionLevel: 'H'
    });
    
    // Criar link de download
    const link = document.createElement('a');
    link.download = 'qrcode-elite-blindagens-apresentacao.png';
    link.href = qrDataUrl;
    link.click();
    
    console.log('[Elite] Download do PNG iniciado');
  } catch (err) {
    console.error('[Elite] Erro ao gerar PNG:', err);
    alert('Erro ao gerar o PNG do QR Code. Tente novamente.');
  }
}

// Download QR Code em PDF com Logo
async function downloadQRCodePDF() {
  try {
    console.log('[Elite] Iniciando geração de PDF...');
    
    // Verificar se jsPDF está carregado
    if (!window.jspdf || !window.jspdf.jsPDF) {
      console.error('[Elite] jsPDF não encontrado');
      alert('Erro ao carregar biblioteca PDF. Bibliotecas não carregadas corretamente.');
      return;
    }
    
    const { jsPDF } = window.jspdf;
    
    // Gerar novo QR code para garantir que funcione
    const qrDataUrl = await QRCode.toDataURL(APRESENTACAO_URL, {
      width: 512,
      margin: 4,
      color: {
        dark: '#1a1a2e',
        light: '#ffffff'
      },
      errorCorrectionLevel: 'H'
    });
    
    console.log('[Elite] QR Code para PDF gerado com sucesso');
    
    // Criar PDF A4
    const pdf = new jsPDF({
      orientation: 'portrait',
      unit: 'mm',
      format: 'a4'
    });
    
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    
    // Cores Elite Blindagens
    const goldColor = [212, 175, 55];
    const darkColor = [26, 26, 46];
    
    // Header com fundo dourado
    pdf.setFillColor(...goldColor);
    pdf.rect(0, 0, pageWidth, 40, 'F');
    
    // Logo Elite (carregar imagem)
    try {
      console.log('[Elite] Carregando logo...');
      const logoImg = new Image();
      logoImg.crossOrigin = 'anonymous';
      logoImg.src = 'assets/logo-elite.png';
      
      await new Promise((resolve, reject) => {
        logoImg.onload = () => {
          console.log('[Elite] Logo carregado com sucesso');
          resolve();
        };
        logoImg.onerror = (e) => {
          console.error('[Elite] Erro ao carregar logo:', e);
          reject(e);
        };
        // Timeout após 3 segundos
        setTimeout(() => reject(new Error('Timeout carregando logo')), 3000);
      });
      
      // Adicionar logo centralizado no header
      const logoWidth = 50;
      const logoHeight = 20;
      const logoX = (pageWidth - logoWidth) / 2;
      pdf.addImage(logoImg, 'PNG', logoX, 10, logoWidth, logoHeight);
    } catch (e) {
      console.warn('[Elite] Usando texto em vez de logo:', e);
      // Se não carregar o logo, usar texto
      pdf.setTextColor(...darkColor);
      pdf.setFontSize(24);
      pdf.setFont('helvetica', 'bold');
      pdf.text('ELITE BLINDAGENS', pageWidth / 2, 25, { align: 'center' });
    }
    
    // Título
    pdf.setTextColor(...darkColor);
    pdf.setFontSize(18);
    pdf.setFont('helvetica', 'bold');
    pdf.text('Apresentação Institucional', pageWidth / 2, 55, { align: 'center' });
    
    // Subtítulo
    pdf.setFontSize(12);
    pdf.setFont('helvetica', 'normal');
    pdf.setTextColor(100, 100, 100);
    pdf.text('Escaneie o QR Code para acessar nossa apresentação', pageWidth / 2, 65, { align: 'center' });
    
    // QR Code
    console.log('[Elite] Adicionando QR code ao PDF');
    const qrSize = 100;
    const qrX = (pageWidth - qrSize) / 2;
    pdf.addImage(qrDataUrl, 'PNG', qrX, 80, qrSize, qrSize);
    
    // Borda dourada ao redor do QR Code
    pdf.setDrawColor(...goldColor);
    pdf.setLineWidth(2);
    pdf.rect(qrX - 5, 75, qrSize + 10, qrSize + 10);
    
    // URL abaixo do QR Code
    pdf.setFontSize(8);
    pdf.setTextColor(100, 100, 100);
    pdf.text(APRESENTACAO_URL, pageWidth / 2, 195, { align: 'center' });
    
    // Informações adicionais
    pdf.setFontSize(10);
    pdf.setTextColor(...darkColor);
    pdf.text('Blindagem de Veículos de Luxo', pageWidth / 2, 210, { align: 'center' });
    pdf.text('Segurança e Sofisticação', pageWidth / 2, 218, { align: 'center' });
    
    // Footer
    pdf.setFillColor(...darkColor);
    pdf.rect(0, pageHeight - 25, pageWidth, 25, 'F');
    
    pdf.setTextColor(255, 255, 255);
    pdf.setFontSize(10);
    pdf.text('www.eliteblindagens.com.br', pageWidth / 2, pageHeight - 15, { align: 'center' });
    pdf.setFontSize(8);
    pdf.text('Excelência em Blindagem Automotiva', pageWidth / 2, pageHeight - 8, { align: 'center' });
    
    // Download
    console.log('[Elite] Salvando PDF...');
    pdf.save('qrcode-elite-blindagens-apresentacao.pdf');
    console.log('[Elite] PDF salvo com sucesso!');
  } catch (error) {
    console.error('[Elite] Erro ao gerar PDF:', error);
    alert('Ocorreu um erro ao gerar o PDF. Verifique o console para mais detalhes.');
  }
}

// Inicializar QR Code quando a aba for exibida
const originalShowTab = showTab;
showTab = function(tab) {
  originalShowTab(tab);
  if (tab === 'qrcode') {
    console.log('[Elite] Aba QR Code ativada, gerando QR code...');
    // Forçar geração do QR Code quando a aba for selecionada
    setTimeout(generateQRCode, 50);
    setTimeout(generateQRCode, 300);
  }
};

// Garantir que o QR code seja gerado imediatamente após o carregamento da página
document.addEventListener('DOMContentLoaded', function() {
  console.log('[Elite] DOM carregado, verificando inicialização do QR Code...');
  
  // Verificar se a aba do QR code está visível e gerar o código
  const qrcodeTab = document.getElementById('tab-qrcode');
  if (qrcodeTab && !qrcodeTab.classList.contains('hidden')) {
    console.log('[Elite] Aba QR Code já está ativa, gerando QR code...');
    // Tentar gerar QR Code várias vezes para garantir que funcione
    setTimeout(generateQRCode, 100);
    setTimeout(generateQRCode, 500);
    setTimeout(generateQRCode, 1000);
  } else {
    console.log('[Elite] Aba QR Code não está ativa inicialmente');
  }
  
  // Forçar geração em último caso após a página estar totalmente carregada
  window.addEventListener('load', function() {
    console.log('[Elite] Página totalmente carregada, forçando geração do QR Code...');
    setTimeout(generateQRCode, 200);
  });
});

// ==========================================
// ATUALIZAÇÃO DO PDF DA APRESENTAÇÃO
// ==========================================

// Service Role Key para upload (NÃO exponha em produção - usar backend)
const SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsYXhibG9pdGlrbmppa3JwYmltIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjgzNDA3NywiZXhwIjoyMDgyNDEwMDc3fQ.aJHSnFXp8cG7kcWCaJI_h-NNPneL2eevy1vt4r96-34';

async function handleNovoPdfUpload(input) {
  const file = input.files[0];
  if (!file) return;

  // Validar arquivo
  if (file.type !== 'application/pdf') {
    alert('Por favor, selecione um arquivo PDF válido.');
    input.value = '';
    return;
  }

  if (file.size > 50 * 1024 * 1024) {
    alert('O arquivo é muito grande. Tamanho máximo: 50MB');
    input.value = '';
    return;
  }

  // Confirmar atualização
  if (!confirm(`Deseja substituir a apresentação atual pelo arquivo "${file.name}"?\n\nO QR Code permanecerá o mesmo.`)) {
    input.value = '';
    return;
  }

  const progressEl = document.getElementById('upload-progress');
  const successEl = document.getElementById('upload-success');
  const btnUpload = document.getElementById('btn-upload-pdf');

  try {
    // Mostrar progresso
    progressEl.classList.remove('hidden');
    successEl.classList.add('hidden');
    btnUpload.disabled = true;

    // Fazer upload para o Supabase Storage
    const response = await fetch(
      `${SUPABASE_URL}/storage/v1/object/apresentacoes/elite-blindagens-apresentacao.pdf`,
      {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
          'apikey': SUPABASE_SERVICE_KEY,
          'Content-Type': 'application/pdf',
          'x-upsert': 'true'
        },
        body: file
      }
    );

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Erro no upload');
    }

    // Sucesso
    progressEl.classList.add('hidden');
    successEl.classList.remove('hidden');
    
    console.log('[Elite] Apresentação atualizada com sucesso!');

    // Esconder mensagem de sucesso após 5 segundos
    setTimeout(() => {
      successEl.classList.add('hidden');
    }, 5000);

  } catch (error) {
    console.error('[Elite] Erro ao atualizar apresentação:', error);
    alert('Erro ao atualizar a apresentação: ' + error.message);
    progressEl.classList.add('hidden');
  } finally {
    btnUpload.disabled = false;
    input.value = '';
  }
}
</script>
</body>
</html>
